<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kidney Stone Detection System</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .header .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        /* Main Content */
        .main-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        /* Form Section */
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section h2 {
            color: #34495e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        /* Upload Section */
        .upload-section {
            margin: 30px 0;
        }
        
        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover {
            background: #e3f2fd;
            border-color: #2980b9;
        }
        
        .upload-area.drag-over {
            background: #bbdefb;
            border-color: #1976d2;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 4em;
            color: #3498db;
            margin-bottom: 20px;
        }
        
        .upload-text {
            color: #34495e;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .upload-subtext {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        #file-input {
            display: none;
        }
        
        /* Preview Section */
        .preview-section {
            display: none;
            margin-top: 30px;
            text-align: center;
        }
        
        .preview-section img {
            max-width: 400px;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Button */
        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-top: 20px;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .analyze-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            margin-top: 30px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Results Section */
        .results-section {
            display: none;
            margin-top: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
        }
        
        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .prediction-badge {
            display: inline-block;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .prediction-normal {
            background: #d4edda;
            color: #155724;
        }
        
        .prediction-stone {
            background: #f8d7da;
            color: #721c24;
        }
        
        .confidence-bar {
            width: 100%;
            height: 40px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 1s ease;
        }
        
        /* Image Comparison */
        .image-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }
        
        .image-box {
            text-align: center;
        }
        
        .image-box h3 {
            color: #34495e;
            margin-bottom: 15px;
        }
        
        .image-box img {
            width: 100%;
            max-width: 400px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .image-box p {
            margin-top: 10px;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        /* Probabilities */
        .probabilities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .prob-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .prob-card h4 {
            color: #34495e;
            margin-bottom: 10px;
        }
        
        .prob-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        
        /* Download Button */
        .download-btn {
            background: #27ae60;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
        }
        
        .download-btn:hover {
            background: #229954;
            transform: translateY(-2px);
        }
        
        /* Recommendations */
        .recommendations {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 5px solid #3498db;
        }
        
        .recommendations h3 {
            color: #34495e;
            margin-bottom: 15px;
        }
        
        .recommendations ul {
            list-style: none;
            padding: 0;
        }
        
        .recommendations li {
            padding: 10px 0;
            color: #2c3e50;
        }
        
        .recommendations li:before {
            content: "‚úì ";
            color: #27ae60;
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* Warning Box */
        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .warning-box strong {
            color: #856404;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            padding: 20px;
        }
        
        .footer p {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="icon">üè•</div>
            <h1>Kidney Stone Detection System</h1>
            <p>AI-Powered Medical Imaging Analysis with Explainable AI (XAI)</p>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Patient Information Form -->
            <div class="form-section">
                <h2>üìã Patient Information</h2>
                <form id="analysis-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="patient-name">Patient Name *</label>
                            <input type="text" id="patient-name" name="patient_name" required placeholder="Enter full name">
                        </div>
                        
                        <div class="form-group">
                            <label for="patient-id">Patient ID *</label>
                            <input type="text" id="patient-id" name="patient_id" required placeholder="Enter patient ID">
                        </div>
                        
                        <div class="form-group">
                            <label for="age">Age *</label>
                            <input type="number" id="age" name="age" required placeholder="Enter age" min="1" max="120">
                        </div>
                        
                        <div class="form-group">
                            <label for="gender">Gender *</label>
                            <select id="gender" name="gender" required>
                                <option value="">Select gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="doctor-name">Doctor Name (Optional)</label>
                        <input type="text" id="doctor-name" name="doctor_name" placeholder="Referring physician">
                    </div>
                </form>
            </div>
            
            <!-- Upload Section -->
            <div class="upload-section">
                <h2>üì§ Upload Kidney Image</h2>
                <div class="upload-area" id="upload-area">
                    <div class="upload-icon">üñºÔ∏è</div>
                    <div class="upload-text">Drag & Drop kidney image here</div>
                    <div class="upload-subtext">or click to browse (JPG, PNG, JPEG)</div>
                </div>
                <input type="file" id="file-input" accept="image/jpeg,image/jpg,image/png">
            </div>
            
            <!-- Preview Section -->
            <div class="preview-section" id="preview-section">
                <h3>Selected Image</h3>
                <img id="preview-image" src="" alt="Preview">
            </div>
            
            <!-- Analyze Button -->
            <div style="text-align: center;">
                <button class="analyze-btn" id="analyze-btn" disabled>
                    üîç Analyze Image
                </button>
            </div>
            
            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing kidney image... Please wait...</p>
            </div>
            
            <!-- Results Section -->
            <div class="results-section" id="results-section">
                <div class="results-header">
                    <h2>üìä Analysis Results</h2>
                    <div class="prediction-badge" id="prediction-badge">
                        <!-- Prediction will be inserted here -->
                    </div>
                    
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidence-fill">
                            <!-- Confidence will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <!-- Probabilities -->
                <div class="probabilities">
                    <div class="prob-card">
                        <h4>Normal Probability</h4>
                        <div class="prob-value" id="normal-prob">--</div>
                    </div>
                    <div class="prob-card">
                        <h4>Stone Probability</h4>
                        <div class="prob-value" id="stone-prob">--</div>
                    </div>
                </div>
                
                <!-- Image Comparison -->
                <div class="image-comparison">
                    <div class="image-box">
                        <h3>Original Image</h3>
                        <img id="original-image" src="" alt="Original">
                        <p>Uploaded kidney scan</p>
                    </div>
                    
                    <div class="image-box">
                        <h3>AI Heatmap (Grad-CAM)</h3>
                        <img id="gradcam-image" src="" alt="Grad-CAM">
                        <p>Red/Yellow areas show suspicious regions detected by AI</p>
                    </div>
                </div>
                
                <!-- Recommendations -->
                <div class="recommendations" id="recommendations">
                    <!-- Recommendations will be inserted here -->
                </div>
                
                <!-- Warning -->
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Medical Disclaimer:</strong> This is an AI-assisted diagnostic tool for decision support only. All results must be verified by qualified medical professionals. This system is not FDA approved and should not be used as the sole basis for medical diagnosis or treatment decisions.
                </div>
                
                <!-- Download Report -->
                <div style="text-align: center;">
                    <a href="#" class="download-btn" id="download-report">
                        üìÑ Download Complete PDF Report
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>Kidney Stone Detection System | Powered by AI & Deep Learning</p>
            <p>¬© 2024 | For Research and Educational Purposes</p>
        </div>
    </div>
    
    <script>
        // DOM Elements
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const previewSection = document.getElementById('preview-section');
        const previewImage = document.getElementById('preview-image');
        const analyzeBtn = document.getElementById('analyze-btn');
        const loading = document.getElementById('loading');
        const resultsSection = document.getElementById('results-section');
        const form = document.getElementById('analysis-form');
        
        // Upload Area Click
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // Drag & Drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        // File Input Change
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        // Handle File
        function handleFile(file) {
            // Validate file type
            if (!file.type.match('image/(jpeg|jpg|png)')) {
                alert('Please upload a valid image file (JPG, PNG, JPEG)');
                return;
            }
            
            // Preview image
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewSection.style.display = 'block';
                analyzeBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }
        
        // Analyze Button
        analyzeBtn.addEventListener('click', async () => {
            // Validate form
            if (!form.checkValidity()) {
                alert('Please fill in all required patient information fields.');
                return;
            }
            
            // Get file
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select an image first.');
                return;
            }
            
            // Prepare form data
            const formData = new FormData(form);
            formData.append('file', file);
            
            // Show loading
            loading.style.display = 'block';
            resultsSection.style.display = 'none';
            analyzeBtn.disabled = true;
            
            try {
                // Send request
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Display results
                displayResults(data);
                
            } catch (error) {
                alert('Error: ' + error.message);
                console.error(error);
            } finally {
                loading.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        });
        
        // Display Results
        function displayResults(data) {
            // Show results section
            resultsSection.style.display = 'block';
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Prediction badge
            const badge = document.getElementById('prediction-badge');
            badge.textContent = data.prediction.toUpperCase();
            badge.className = 'prediction-badge ' + 
                (data.prediction === 'Normal' ? 'prediction-normal' : 'prediction-stone');
            
            // Confidence bar
            const confidenceFill = document.getElementById('confidence-fill');
            confidenceFill.style.width = data.confidence + '%';
            confidenceFill.textContent = data.confidence + '% Confidence';
            
            // Probabilities
            document.getElementById('normal-prob').textContent = data.probabilities.normal + '%';
            document.getElementById('stone-prob').textContent = data.probabilities.stone + '%';
            
            // Images
            document.getElementById('original-image').src = data.original_image;
            document.getElementById('gradcam-image').src = data.gradcam_image;
            
            // Recommendations
            const recommendations = document.getElementById('recommendations');
            if (data.prediction === 'Stone') {
                recommendations.innerHTML = `
                    <h3>‚ö†Ô∏è Recommendations</h3>
                    <ul>
                        <li>Consult with a urologist for treatment options</li>
                        <li>Consider additional imaging (CT scan) for detailed assessment</li>
                        <li>Discuss stone size, location, and treatment approaches</li>
                        <li>Monitor symptoms and maintain adequate hydration</li>
                        <li>Follow up within 1-2 weeks or sooner if symptoms worsen</li>
                    </ul>
                `;
            } else {
                recommendations.innerHTML = `
                    <h3>‚úÖ Recommendations</h3>
                    <ul>
                        <li>Continue routine monitoring and regular checkups</li>
                        <li>Maintain adequate daily hydration (8-10 glasses of water)</li>
                        <li>Follow preventive dietary measures</li>
                        <li>Monitor for any new symptoms</li>
                        <li>Schedule follow-up as recommended by physician</li>
                    </ul>
                `;
            }
            
            // Download report button
            document.getElementById('download-report').href = data.report_url;
        }
    </script>
</body>
</html>
